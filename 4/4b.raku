my@l=lines;$!=->\n {1+sum map ->[\a,$_]{$!(a)*(m:ov/\s(\d+)\s.*\|.*\s$0(\s|$$)/>=n -a)},(^n Z@l)};say sum (^@l)>>.$!
# Use a cached version for actual calculation for the big test case